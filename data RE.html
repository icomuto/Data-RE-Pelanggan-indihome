<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Input Database Pelanggan</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #e9ecef; padding: 20px; }
        .container { max-width: 500px; margin: 0 auto; background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #333; margin-bottom: 20px; border-bottom: 2px solid #0088cc; padding-bottom: 10px; }
        label { display: block; margin-top: 12px; font-weight: 600; font-size: 14px; color: #555; }
        input, select, textarea { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; transition: border 0.3s; }
        input:focus, select:focus, textarea:focus { border-color: #0088cc; outline: none; }
        
        .buttons { margin-top: 25px; }
        button { width: 100%; padding: 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 16px; transition: background 0.3s; }
        
        .btn-submit { background-color: #0088cc; color: white; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-submit:hover { background-color: #006699; }
        .btn-submit:disabled { background-color: #ccc; cursor: not-allowed; }

        .loading-spinner {
            border: 4px solid #f3f3f3; border-top: 4px solid #fff; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: none;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        #output { height: 1px; width: 1px; opacity: 0; position: absolute; } /* Hidden but selectable */
        .status-msg { text-align: center; margin-top: 10px; font-size: 14px; font-weight: bold; min-height: 20px; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>

<div class="container">
    <h2>DATA REGISTRASI</h2>
    
    <form id="dataForm">
        <label>TRACK ID :</label>
        <input type="text" id="trackId" placeholder="Masukkan Track ID" required>

        <label>Nama sesuai KTP :</label>
        <input type="text" id="nama" placeholder="Nama Lengkap" required>

        <label>Alamat pemasangan :</label>
        <textarea id="alamat" rows="2" placeholder="Alamat Lengkap" required></textarea>

        <label>Email aktif :</label>
        <input type="email" id="email" placeholder="contoh@gmail.com">

        <label>No.telp aktif :</label>
        <input type="tel" id="telp" placeholder="08xxxxxxxxxx" required>

        <label>No.telp alternatif :</label>
        <input type="tel" id="telpAlt" placeholder="08xxxxxxxxxx">

        <label>Paket yang di pilih :</label>
        <select id="paket" onchange="updateHarga()" required>
            <option value="">-- Pilih Paket --</option>
            <option value="20 mbps">20 mbps</option>
            <option value="50 mbps">50 mbps</option>
            <option value="75 mbps">75 mbps</option>
            <option value="150 mbps">150 mbps</option>
            <option value="200 mbps">200 mbps</option>
        </select>

        <label>Harga paket :</label>
        <select id="harga" required>
            <option value="">-- Pilih Harga --</option>
            <option value="Rp190.000">Rp190.000</option>
            <option value="Rp240.000">Rp240.000</option>
            <option value="Rp270.000">Rp270.000</option>
            <option value="Rp375.000">Rp375.000</option>
            <option value="Rp515.000">Rp515.000</option>
        </select>

        <label>No. Internet :</label>
        <input type="text" id="noInternet" placeholder="Nomor Internet">
        
        <div class="buttons">
            <button type="button" class="btn-submit" onclick="prosesData()" id="btnKirim">
                <div class="loading-spinner" id="spinner"></div>
                KIRIM KE DATABASE & COPY
            </button>
        </div>
        <div id="status" class="status-msg"></div>
    </form>

    <!-- Area tersembunyi untuk copy text -->
    <textarea id="output"></textarea>
</div>

<script>
    // =========================================================
    // PASTE URL DARI GOOGLE APPS SCRIPT DI BAWAH INI (Di dalam tanda kutip)
    // =========================================================
    const SCRIPT_URL = 'PASTE_URL_APPS_SCRIPT_DISINI'; 

    function updateHarga() {
        const paket = document.getElementById("paket").value;
        const hargaSelect = document.getElementById("harga");
        const hargaMap = {
            "20 mbps": "Rp190.000",
            "50 mbps": "Rp240.000",
            "75 mbps": "Rp270.000",
            "150 mbps": "Rp375.000",
            "200 mbps": "Rp515.000"
        };
        if (hargaMap[paket]) {
            hargaSelect.value = hargaMap[paket];
        }
    }

    function prosesData() {
        const btn = document.getElementById('btnKirim');
        const spinner = document.getElementById('spinner');
        const status = document.getElementById('status');
        
        // Ambil Data
        const data = {
            trackId: document.getElementById("trackId").value,
            nama: document.getElementById("nama").value,
            alamat: document.getElementById("alamat").value,
            email: document.getElementById("email").value,
            telp: document.getElementById("telp").value,
            telpAlt: document.getElementById("telpAlt").value,
            paket: document.getElementById("paket").value,
            harga: document.getElementById("harga").value,
            noInternet: document.getElementById("noInternet").value
        };

        // Validasi simpel
        if(!data.nama || !data.paket) {
            alert("Harap lengkapi Nama dan Paket!");
            return;
        }

        // Tampilkan Loading
        btn.disabled = true;
        spinner.style.display = "block";
        btn.firstChild.nextSibling.textContent = " SEDANG MENGIRIM...";
        status.textContent = "";

        // 1. KIRIM KE GOOGLE SHEETS
        fetch(SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors', // Penting agar tidak error di browser
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
        .then(() => {
            // 2. JIKA SUKSES, COPY TEXT TELEGRAM
            copyToClipboard(data);
            
            // Reset Form & UI
            document.getElementById("dataForm").reset();
            status.className = "status-msg success";
            status.textContent = "âœ… Data tersimpan di Database & Tercopy!";
            
            setTimeout(() => { status.textContent = ""; }, 5000);
        })
        .catch(err => {
            console.error('Error:', err);
            status.className = "status-msg error";
            status.textContent = "âŒ Gagal mengirim ke Database, tapi teks tercopy.";
            copyToClipboard(data); // Tetap copy teks meski database gagal
        })
        .finally(() => {
            btn.disabled = false;
            spinner.style.display = "none";
            btn.firstChild.nextSibling.textContent = "KIRIM KE DATABASE & COPY";
        });
    }

    function copyToClipboard(data) {
        const textResult = `DATA REGISTRASI PELANGGAN

TRACK ID : ${data.trackId}
ðŸ‘‰Nama sesuai KTP: ${data.nama}
ðŸ‘‰Alamat pemasangan : ${data.alamat}
ðŸ‘‰Email aktif : ${data.email}
ðŸ‘‰No.telp aktif : ${data.telp}
ðŸ‘‰No.telp alternatif : ${data.telpAlt}
ðŸ‘‰Foto KTP : (Terlampir)
ðŸ‘‰Paket yang di pilih  : ${data.paket}
ðŸ‘‰Harga paket : ${data.harga}
ðŸ‘‰No . Internet : ${data.noInternet}
ðŸ‘‰Foto Rupel : (Terlampir)`;

        const outputBox = document.getElementById("output");
        outputBox.value = textResult;
        outputBox.select();
        outputBox.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(textResult).then(() => {
            // Optional: Alert jika ingin notifikasi pop-up
            // alert("Teks sudah di-copy! Silakan paste ke Telegram."); 
        });
    }
</script>

</body>
</html>