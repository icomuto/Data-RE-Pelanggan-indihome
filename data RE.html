<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Input Registrasi Pelanggan</title>
    
    <!-- Bootstrap 5 CSS (Tampilan Modern) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome (Ikon) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- SweetAlert2 (Pop up cantik) -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        body {
            background-color: #f0f2f5;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .main-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .header-bg {
            background: linear-gradient(135deg, #0d6efd, #0a58ca);
            color: white;
            border-radius: 15px 15px 0 0;
            padding: 20px;
            text-align: center;
        }
        .form-floating > label {
            font-size: 0.9rem;
        }
        .btn-kirim {
            background: linear-gradient(135deg, #198754, #157347);
            border: none;
            padding: 12px;
            font-weight: bold;
            font-size: 1.1rem;
            transition: transform 0.2s;
        }
        .btn-kirim:active {
            transform: scale(0.98);
        }
        /* Hidden textarea for copy mechanism */
        #clipboardArea {
            position: absolute;
            left: -9999px;
        }
    </style>
</head>
<body>

<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-6 col-md-8">
            <div class="card main-card">
                <div class="header-bg">
                    <h4 class="mb-0"><i class="fa-solid fa-user-plus me-2"></i>Registrasi Pelanggan</h4>
                    <small>Input Data & Auto Copy Telegram</small>
                </div>
                
                <div class="card-body p-4">
                    <form id="inputForm">
                        
                        <!-- TRACK ID -->
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="trackId" placeholder="Track ID" required>
                            <label for="trackId">TRACK ID</label>
                        </div>

                        <!-- NAMA -->
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="nama" placeholder="Nama Sesuai KTP" required>
                            <label for="nama">Nama sesuai KTP</label>
                        </div>

                        <!-- ALAMAT -->
                        <div class="form-floating mb-3">
                            <textarea class="form-control" id="alamat" placeholder="Alamat" style="height: 80px" required></textarea>
                            <label for="alamat">Alamat Pemasangan</label>
                        </div>

                        <!-- KONTAK -->
                        <div class="row g-2 mb-3">
                            <div class="col-6">
                                <div class="form-floating">
                                    <input type="tel" class="form-control" id="telp" placeholder="No HP" required>
                                    <label for="telp">No. Telp Aktif</label>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-floating">
                                    <input type="tel" class="form-control" id="telpAlt" placeholder="No Alt">
                                    <label for="telpAlt">No. Alternatif</label>
                                </div>
                            </div>
                        </div>

                        <!-- EMAIL -->
                        <div class="form-floating mb-3">
                            <input type="email" class="form-control" id="email" placeholder="Email">
                            <label for="email">Email Aktif</label>
                        </div>

                        <!-- PAKET & HARGA -->
                        <div class="row g-2 mb-3">
                            <div class="col-6">
                                <div class="form-floating">
                                    <select class="form-select" id="paket" onchange="updateHarga()" required>
                                        <option value="" selected disabled>Pilih</option>
                                        <option value="20 mbps">20 mbps</option>
                                        <option value="50 mbps">50 mbps</option>
                                        <option value="75 mbps">75 mbps</option>
                                        <option value="150 mbps">150 mbps</option>
                                        <option value="200 mbps">200 mbps</option>
                                    </select>
                                    <label for="paket">Paket</label>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-floating">
                                    <select class="form-select" id="harga" required>
                                        <option value="" selected disabled>Harga</option>
                                        <option value="Rp190.000">Rp190.000</option>
                                        <option value="Rp240.000">Rp240.000</option>
                                        <option value="Rp270.000">Rp270.000</option>
                                        <option value="Rp375.000">Rp375.000</option>
                                        <option value="Rp515.000">Rp515.000</option>
                                    </select>
                                    <label for="harga">Harga</label>
                                </div>
                            </div>
                        </div>

                        <!-- NO INTERNET -->
                        <div class="form-floating mb-4">
                            <input type="text" class="form-control" id="noInternet" placeholder="No Internet">
                            <label for="noInternet">No. Internet</label>
                        </div>

                        <!-- TOMBOL -->
                        <button type="submit" class="btn btn-success w-100 btn-kirim shadow">
                            <i class="fa-brands fa-telegram me-2"></i> KIRIM & COPY
                        </button>
                        
                        <div class="text-center mt-3">
                            <small class="text-muted fst-italic">*Foto KTP & Rupel diupload manual di Telegram</small>
                        </div>

                    </form>
                </div>
            </div>
            
            <div class="text-center mt-3 text-muted">
                <small>&copy; 2025 Database Management</small>
            </div>
        </div>
    </div>
</div>

<textarea id="clipboardArea"></textarea>

<script>
    // ==========================================================
    // CONFIG: MASUKKAN URL GOOGLE SCRIPT DI SINI (DALAM KUTIP)
    // ==========================================================
    const SCRIPT_URL = 'GANTI_DENGAN_URL_APPS_SCRIPT_ANDA_DISINI'; 

    // Mapping Harga Otomatis
    function updateHarga() {
        const paket = document.getElementById("paket").value;
        const hargaSelect = document.getElementById("harga");
        const hargaMap = {
            "20 mbps": "Rp190.000",
            "50 mbps": "Rp240.000",
            "75 mbps": "Rp270.000",
            "150 mbps": "Rp375.000",
            "200 mbps": "Rp515.000"
        };
        if (hargaMap[paket]) {
            hargaSelect.value = hargaMap[paket];
        }
    }

    // Handle Submit Form
    document.getElementById('inputForm').addEventListener('submit', function(e) {
        e.preventDefault(); // Mencegah reload halaman
        
        const btn = document.querySelector('.btn-kirim');
        const originalText = btn.innerHTML;
        
        // Ambil Data Form
        const data = {
            trackId: document.getElementById("trackId").value,
            nama: document.getElementById("nama").value,
            alamat: document.getElementById("alamat").value,
            email: document.getElementById("email").value || "-",
            telp: document.getElementById("telp").value,
            telpAlt: document.getElementById("telpAlt").value || "-",
            paket: document.getElementById("paket").value,
            harga: document.getElementById("harga").value,
            noInternet: document.getElementById("noInternet").value || "-"
        };

        // Loading State
        btn.disabled = true;
        btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Mengirim...';

        // 1. Kirim ke Google Sheets
        fetch(SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors', 
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        })
        .then(() => {
            // 2. Format Teks Telegram
            const textResult = `DATA REGISTRASI PELANGGAN

TRACK ID : ${data.trackId}
ðŸ‘‰Nama sesuai KTP: ${data.nama}
ðŸ‘‰Alamat pemasangan : ${data.alamat}
ðŸ‘‰Email aktif : ${data.email}
ðŸ‘‰No.telp aktif : ${data.telp}
ðŸ‘‰No.telp alternatif : ${data.telpAlt}
ðŸ‘‰Foto KTP : (Terlampir)
ðŸ‘‰Paket yang di pilih  : ${data.paket}
ðŸ‘‰Harga paket : ${data.harga}
ðŸ‘‰No . Internet : ${data.noInternet}
ðŸ‘‰Foto Rupel : (Terlampir)`;

            // 3. Copy ke Clipboard
            const area = document.getElementById("clipboardArea");
            area.value = textResult;
            area.select();
            document.execCommand("copy"); // Fallback method

            // 4. Tampilkan Sukses
            Swal.fire({
                title: 'Berhasil!',
                text: 'Data masuk Database & Teks sudah dicopy!',
                icon: 'success',
                confirmButtonColor: '#198754',
                confirmButtonText: 'Oke, Buka Telegram'
            });

            // Reset Form
            document.getElementById("inputForm").reset();
        })
        .catch(error => {
            console.error('Error!', error.message);
            Swal.fire({
                title: 'Error!',
                text: 'Gagal koneksi ke database. Cek internet Anda.',
                icon: 'error'
            });
        })
        .finally(() => {
            btn.disabled = false;
            btn.innerHTML = originalText;
        });
    });
</script>

</body>
</html>